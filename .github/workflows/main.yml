name: Fetch JSON and Update Repository

on:
  schedule:
    - cron: '0 * * * *' # 每小時運行一次
  workflow_dispatch: # 允許手動觸發工作流

jobs:
  fetch-json:
    runs-on: ubuntu-latest

    steps:
      # 檢出儲存庫代碼
      - name: Checkout repository
        uses: actions/checkout@v3

      # 使用 curl 下載 JSON 文件
      - name: Fetch JSON from URL
        run: |
          curl -o data.json https://script.googleusercontent.com/macros/echo?user_content_key=MpSl-D13EskcisGdBe3lEMmNTponZpH79PBNFr93OsuL__GIV4sP82rCA14uMlCSXIBito0vCi_QRESuEnyaH_EmkWOB51PZm5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnKTM_JbsfQhV1yEygiZ4YnV6dWAG3CmQ1AWqxKbXPIVX8IXNRkSbEc8NfZzBqr2hugdnld5Yn7k7DRUg7h26Ey0FYlMIsRFedA&lib=MF2kfSYcESCbpR9KTFnXGHaK8tyGuBg3U

      # 提交並推送更改
      - name: Commit and Push changes
        env:
          PAT: ${{ secrets.PAT }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git pull --rebase origin main # 拉取最新更改並重置基準
          git add data.json
          git commit -m "Update JSON file"
          git push https://x-access-token:${PAT}@github.com/${{ github.repository }}.git
