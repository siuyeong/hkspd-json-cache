name: Fetch JSON and Update Repository

on:
  schedule:
    - cron: '0 * * * *' # 每小時運行一次
  workflow_dispatch: # 允許手動觸發工作流

jobs:
  fetch-json:
    runs-on: ubuntu-latest

    steps:
      # 檢出儲存庫代碼
      - name: Checkout repository
        uses: actions/checkout@v3

      # 使用 curl 下載 JSON 文件
      - name: Fetch JSON from URL
        run: |
          curl -o data.json https://script.google.com/macros/s/AKfycby_ssZQyVKzA57TBvApvqEsHrRMMx0JH3W3tcAIAIPLRLI-9t29U1NVoLU-ve3EgbDB/exec

      # 提交並推送更改
      - name: Commit and Push changes
        env:
          PAT: ${{ secrets.PAT }}
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add data.json
          git commit -m "Update JSON file"
          git push https://x-access-token:${PAT}@github.com/${{ github.repository }}.git
